---
import Layout from '../layouts/Layout.astro';
---

<Layout title="æ¬¢è¿æ¥åˆ°è¨€è¥¿æ—©æœ¨çš„åšå®¢">
	<main>
		<div class="content-wrapper">
			<div class="hero">
				<h1 class="calligraphy-title"><span class="text-gradient">æ¬¢è¿æ¥åˆ°è¨€è¥¿æ—©æœ¨çš„åšå®¢</span></h1>
				<div class="quote-container">
					<p id="hitokoto-text" class="quote-text">æ­£åœ¨è†å¬å®‡å®™çš„ä½è¯­...</p>
					<p id="hitokoto-from" class="quote-author"></p>
				</div>
				<div class="hero-status">
					<div class="status-item">
						<span class="status-icon">ğŸ“…</span>
						<span id="hero-date">...</span>
					</div>
					<div class="status-divider"></div>
					<div class="status-item">
						<span class="status-icon">ğŸ“</span>
						<span id="hero-region">è·å–ä½ç½®...</span>
					</div>
					<div class="status-divider"></div>
					<div class="status-item">
						<span class="status-icon">ğŸŒ¡ï¸</span>
						<span id="hero-weather">è·å–å¤©æ°”...</span>
					</div>
				</div>
				<div class="hero-actions">
					<a href="/blog" class="btn btn-primary">å¼€å§‹é˜…è¯»</a>
					<a href="/about" class="btn btn-secondary">äº†è§£æ›´å¤š</a>
				</div>
			</div>

			<ul role="list" class="link-card-grid">
				<li class="link-card">
					<a href="/blog">
						<h2>æ–‡ç« åˆ—è¡¨ &rarr;</h2>
						<p>
							é˜…è¯»æœ€æ–°çš„æŠ€æœ¯æ–‡ç« å’Œå­¦ä¹ ç¬”è®°ã€‚
						</p>
					</a>
				</li>
				<li class="link-card">
					<a href="/about">
						<h2>å…³äºæˆ‘ &rarr;</h2>
						<p>
							äº†è§£æ›´å¤šå…³äºæˆ‘ä»¥åŠè¿™ä¸ªé¡¹ç›®çš„ä¿¡æ¯ã€‚
						</p>
					</a>
				</li>
				<li class="link-card">
					<a href="/friends">
						<h2>å‹æƒ…é“¾æ¥ &rarr;</h2>
						<p>
							å‘ç°æ›´å¤šæœ‰è¶£çš„åšå®¢å’Œç½‘ç«™ã€‚
						</p>
					</a>
				</li>
				<li class="link-card">
					<a href="https://linux.do" target="_blank">
						<h2>Linux.do ç¤¾åŒº &rarr;</h2>
						<p>
							é‡ç°äº’è”ç½‘ç²¾ç¥ï¼ŒåŠ å…¥æˆ‘ä»¬å……æ»¡æ´»åŠ›çš„æŠ€æœ¯ç¤¾åŒºã€‚
						</p>
					</a>
				</li>
			</ul>
		</div>
	</main>
</Layout>

<style>
	main {
		margin: auto;
		padding: 2rem 1rem;
		max-width: 900px;
		user-select: none;
		-webkit-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
	}

	.content-wrapper {
		display: flex;
		flex-direction: column;
		align-items: center;
		padding-top: 3rem;
	}

	.hero {
		text-align: center;
		margin-bottom: 4rem;
	}

	h1 {
		font-size: 3.5rem;
		font-weight: 700;
		line-height: 1.2;
		margin-bottom: 1rem;
		letter-spacing: -0.02em;
	}

	.calligraphy-title {
		font-family: var(--font-special);
		font-size: 4rem;
		font-weight: 400;
	}

	.text-gradient {
		background: linear-gradient(135deg, var(--c-primary), var(--c-secondary), var(--c-primary));
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-size: 200%;
	}

	.quote-container {
		min-height: 80px;
		margin-bottom: 2.5rem;
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		gap: 0.5rem;
	}

	.quote-text {
		color: var(--c-text);
		font-size: 1.2rem;
		font-weight: 300;
		line-height: 1.6;
		font-family: var(--font-family-base);
	}

	.quote-author {
		color: var(--c-text-light);
		font-size: 0.9rem;
		font-style: italic;
	}

	.hero-status {
		display: inline-flex;
		align-items: center;
		background: rgba(255, 255, 255, 0.2);
		backdrop-filter: blur(16px) saturate(180%);
		-webkit-backdrop-filter: blur(16px) saturate(180%);
		padding: 0.5rem 1.5rem;
		border-radius: 2rem;
		border: 1px solid var(--c-card-border);
		margin-bottom: 2rem;
		gap: 1.2rem;
		box-shadow: 0 4px 25px rgba(0, 0, 0, 0.08);
	}

	html[data-theme='dark'] .hero-status {
		background: rgba(30, 31, 35, 0.3);
		backdrop-filter: blur(16px) saturate(180%);
		-webkit-backdrop-filter: blur(16px) saturate(180%);
		border-color: var(--c-card-border);
		box-shadow: 0 4px 25px rgba(0, 0, 0, 0.2);
	}

	.status-item {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		font-size: 0.9rem;
		color: var(--c-text);
	}

	.status-divider {
		width: 1px;
		height: 15px;
		background: rgba(0, 0, 0, 0.1);
	}

	html[data-theme='dark'] .status-divider {
		background: rgba(255, 255, 255, 0.1);
	}

	.hero-actions {
		display: flex;
		gap: 1rem;
		justify-content: center;
		margin-top: 2rem;
	}

	.btn {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		padding: 0.75rem 2.5rem;
		border-radius: var(--radius-btn);
		text-decoration: none;
		font-weight: 600;
		position: relative;
		overflow: hidden;
		z-index: 1;
		backdrop-filter: blur(8px);
		-webkit-backdrop-filter: blur(8px);
		border: 1px solid transparent;
	}

	.btn:active {
		transform: scale(0.98);
	}

	.btn-primary {
		color: #ffffff;
		background: linear-gradient(135deg, var(--c-primary), var(--c-secondary));
		box-shadow: 0 4px 15px rgba(56, 182, 255, 0.4);
		border-color: rgba(255, 255, 255, 0.3);
	}

	.btn-primary::before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: linear-gradient(135deg, var(--c-secondary), var(--c-primary));
		opacity: 0;
		z-index: -1;
	}

	.btn-secondary {
		background: rgba(255, 255, 255, 0.3);
		backdrop-filter: blur(10px);
		-webkit-backdrop-filter: blur(10px);
		color: var(--c-text);
		border: 1px solid var(--c-card-border);
		box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
	}

	.link-card-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
		gap: 2rem;
		padding: 0;
		width: 100%;
		list-style: none;
	}

	.link-card {
		position: relative;
		background: var(--c-card-bg);
		backdrop-filter: blur(12px) saturate(180%);
		-webkit-backdrop-filter: blur(12px) saturate(180%);
		border-radius: var(--radius-card);
		box-shadow: var(--shadow-light);
		overflow: hidden;
		border: 1px solid var(--c-card-border);
	}

	.link-card > a {
		display: block;
		padding: var(--padding-card);
		text-decoration: none;
		color: var(--c-text);
		height: 100%;
		user-select: none;
		-webkit-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		cursor: pointer;
	}

	.link-card h2 {
		margin: 0;
		font-size: 1.25rem;
		margin-bottom: 0.5rem;
		color: var(--c-text);
	}

	.link-card p {
		margin: 0;
		color: var(--c-text-light);
		font-size: 0.95rem;
		line-height: 1.6;
	}

	html[data-theme='dark'] .btn-secondary {
		background: rgba(30, 31, 35, 0.4);
		backdrop-filter: blur(10px);
		-webkit-backdrop-filter: blur(10px);
		border-color: var(--c-card-border);
		color: var(--c-text);
		box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
	}

	html[data-theme='dark'] .link-card {
		background: var(--c-card-bg);
		backdrop-filter: blur(12px) saturate(180%);
		-webkit-backdrop-filter: blur(12px) saturate(180%);
		border-color: var(--c-card-border);
	}

	html[data-theme='dark'] .link-card h2 {
		color: var(--c-text);
	}

	html[data-theme='dark'] .link-card p {
		color: var(--c-text-light);
	}
</style>

<script is:inline>
	// ä¸€è¨€APIå’ŒçŠ¶æ€åŒæ­¥
	let quoteRetryCount = 0;
	const maxQuoteRetries = 3;
	const fallbackQuotes = [
		{ text: 'çºµä½¿å‰è·¯æ¼«æ¼«ï¼Œäº¦è¦ç ¥ç ºå‰è¡Œã€‚', from: 'è¨€è¥¿æ—©æœ¨' },
		{ text: 'ä»£ç å¦‚è¯—ï¼Œè®°å½•å¦‚é…’ã€‚', from: 'è¨€è¥¿æ—©æœ¨' },
		{ text: 'å­¦ä¹ æ˜¯ä¸€åœºæ°¸æ— æ­¢å¢ƒçš„æ—…ç¨‹ã€‚', from: 'è¨€è¥¿æ—©æœ¨' },
		{ text: 'ä¿æŒçƒ­çˆ±ï¼Œå¥”èµ´å±±æµ·ã€‚', from: 'è¨€è¥¿æ—©æœ¨' }
	];

	async function updateQuote() {
		const textEl = document.getElementById('hitokoto-text');
		const fromEl = document.getElementById('hitokoto-from');
		
		try {
			const controller = new AbortController();
			const timeoutId = setTimeout(() => controller.abort(), 5000);
			
			const response = await fetch('https://v1.hitokoto.cn/', {
				signal: controller.signal
			});
			
			clearTimeout(timeoutId);
			
			if (response.ok) {
				const data = await response.json();
				
				textEl.textContent = data.hitokoto;
				fromEl.textContent = `â€”â€” ã€Œ ${data.from} ã€`;
				
				quoteRetryCount = 0;
			} else {
				throw new Error(`HTTP ${response.status}`);
			}
		} catch (e) {
			console.log('ä¸€è¨€APIè¯·æ±‚å¤±è´¥:', e.message);
			
			if (quoteRetryCount < maxQuoteRetries) {
				quoteRetryCount++;
				console.log(`ä¸€è¨€APIé‡è¯• ${quoteRetryCount}/${maxQuoteRetries}`);
				setTimeout(updateQuote, 2000 * quoteRetryCount);
				return;
			}
			
			const fallback = fallbackQuotes[Math.floor(Math.random() * fallbackQuotes.length)];
			textEl.textContent = fallback.text;
			fromEl.textContent = `â€”â€” ã€Œ ${fallback.from} ã€`;
			quoteRetryCount = 0;
		}
	}

	// åŒæ­¥çŠ¶æ€æ 
	function syncStatus() {
		const hDate = document.getElementById('hero-date');
		const hRegion = document.getElementById('hero-region');
		const hWeather = document.getElementById('hero-weather');
		
		const gDate = document.getElementById('current-date');
		const gRegion = document.getElementById('current-region');
		const gWeather = document.getElementById('current-weather');
		
		if (hDate && gDate) hDate.textContent = gDate.textContent;
		if (hRegion && gRegion) hRegion.textContent = gRegion.textContent;
		if (hWeather && gWeather) hWeather.textContent = gWeather.textContent;
	}

	// åˆå§‹åŠ è½½
	updateQuote();
	// æ¯10ç§’æ›´æ–°ä¸€æ¬¡
	setInterval(updateQuote, 10000);

	// åŒæ­¥çŠ¶æ€æ 
	setTimeout(syncStatus, 500);
	setInterval(syncStatus, 2000);
</script>